<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:p="http://primefaces.org/ui">

    <div class="panel panel-default">
        <h:form id="ProductosSearchSmallForm">
            <h:panelGrid columns="6" style="margin-bottom:10px">
                <p:outputLabel for="advanced" value="Productos Pendientes de Entrega " />
                <p:selectOneMenu id="advanced" 
                                 value="#{remisionesController.selectedProduct}" 
                                 converter="#{pedidosProductoConverter}"
                                 var="t" 
                               
                                 styleClass="col-md-6"

                                 >
                    <f:selectItems value="#{remisionesController.incPendingOrders}" 
                                   var="selectedItem"
                                   itemLabel="#{selectedItem.idProducto.nombre}" 
                                   itemValue="#{selectedItem}" 
                                   />
                    <!--    <p:ajax update="li_version li_files b_download"
                                               partialSubmit="false"
                                               listener="#{dialog.docTypeChanged}"
                                               event="change"/> -->
                    <p:column headerText="Orden Compra">
                        <h:outputText value="#{t.idPedido.referencia}" />
                    </p:column>
                     <p:column headerText="Fecha Solicitada">
                        <h:outputText value="#{t.idPedido.fechaPedido}">
                            <f:convertDateTime locale="es" pattern="dd/MMMMM/yyyy" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="Producto">
                        <h:outputText value="#{t.idProducto.nombre}" />
                    </p:column>
                    <p:column headerText="Referencia">
                        <h:outputText value="#{t.idProducto.referencia}" />
                    </p:column>
                    <p:column headerText="Cantidad Solicitada">
                        <h:outputText value="#{t.cantidad}" />
                    </p:column>
                </p:selectOneMenu>
                 <p:column><p:outputLabel value="&#160;" /></p:column>
                  
                <p:column>
                    <p:commandButton id="addProductButton" icon="ui-icon-plus"
                                     update=":RemisionesCreateForm:ref  :ProductosListForm, :RemisionesCreateForm:panelCantidadProductos msgs"  
                                     actionListener="#{remisionesController.addProduct(ActionEvent)}" 
                                     />
                    <p:tooltip for="addProductButton" value="Agrega un producto de la Orden de Compra a la Remision"/>

                </p:column>
                 
                  <p:column><p:outputLabel value="&#160;" /></p:column>
                    <p:column>
                    <p:commandButton id="addAllProductsButton" icon="ui-icon-arrowreturnthick-1-s"
                                     update=":RemisionesCreateForm:ref  :ProductosListForm, :RemisionesCreateForm:panelCantidadProductos msgs"  
                                     actionListener="#{remisionesController.addAllProducts(ActionEvent)}" 
                                     />
                    <p:tooltip for="addAllProductsButton" value="Agrega todos los productos de la Orden de Compra a la Remision"/>

                </p:column>
                  
                   <p:outputLabel for="checkMore" value="Incluir ordenes de compra pendientes del cliente" />
                  <p:selectBooleanCheckbox id="checkMore" value="#{remisionesController.allPendings}">
                     <p:ajax update="@form:advanced" listener="#{remisionesController.chargeAllPendings()}" />
                 </p:selectBooleanCheckbox>
                
            </h:panelGrid>
        </h:form>
     
    </div>
    <h:form id="ProductosListForm">
        <div class='panel panel-#{navigation.moduleType("PRODUCTOS")}'>
            <div class="panel-heading">Art√≠culos de la Remision</div>

            <p:dataTable id="datalist"
                         value="#{remisionesController.selected.remisionesProductoList}"
                         var="item"
                         rowKey="#{item.id}"
                         paginator="false"
                         rows="30"
                         rowsPerPageTemplate="10,20,30,40,50,100"
                         selectionMode="single"
                         selection="#{remisionesController.selectedRemisionProduct}"
                         tableStyleClass="table table-striped"
                         editable="true" editMode="cell"
                         >

               <p:ajax event="rowSelect"  
                        update="@form:deleteButton"/>
                         
               
                <p:column sortBy="#{item.id}" filterBy="#{item.id}" rendered="false">
                    <f:facet name="header">
                        <h:outputText value="#{innventa.ListProductosTitle_id}"/>
                    </f:facet>
                    <h:outputText value="#{item.id}"/>
                </p:column>
                 <p:column >
                    <f:facet name="header">
                        <h:outputText value="O. C. "/>
                    </f:facet>
                    <h:outputText value="#{item.idPedido.referencia}"/>
                </p:column>
                 <p:column >
                    <f:facet name="header">
                        <h:outputText value="Referencia"/>
                    </f:facet>
                    <h:outputText value="#{item.idProducto.referencia}"/>
                </p:column>
                <p:column >
                    <f:facet name="header">
                        <h:outputText value="Producto"/>
                    </f:facet>
                    <h:outputText value="#{item.idProducto.nombre}"/>
                </p:column>

                <p:column headerText="Cantidad">
                    <p:cellEditor>
                        <f:facet name="output"><h:outputText value="#{item.cantidad}" /></f:facet>
                        <f:facet name="input">
                            <p:inputText value="#{item.cantidad}" style="width:100%">
                                <p:ajax listener="#{remisionesController.onRowEdit(item, item.cantidad)}" update="@form:datalist @form:deleteButton :RemisionesCreateForm:panelCantidadProductos msgs" />
                            </p:inputText>
                        </f:facet>
                    </p:cellEditor>
                    
                </p:column>
              
            </p:dataTable>

      
            <p:commandButton id="deleteButton"  icon="ui-icon-trash"  value="#{innventa.Delete}" 
                             actionListener="#{remisionesController.delProduct}" 
                             update=":ProductosListForm,msgs,datalist, :RemisionesCreateForm:panelCantidadProductos" 
                             disabled="#{empty remisionesController.selectedRemisionProduct}"/>


        </div>
        <ui:include src="/confirmation.xhtml"/>
    </h:form>

</ui:composition>